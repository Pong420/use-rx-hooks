(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{113:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__webpack_require__(1),rxjs_1=__webpack_require__(843),initialArg={loading:!1};function reducer(state,action){switch(action.type){case"FETCH_INIT":return __assign(__assign({},initialArg),{loading:!0,data:state.data});case"FETCH_SUCCESS":return __assign(__assign({},state),{loading:!1,data:action.payload});case"FETCH_FAILURE":return __assign(__assign({},state),{loading:!1,error:action.payload});case"CANCEL":return __assign(__assign({},state),{loading:!1});default:throw new Error}}exports.useRxAsync=function useRxAsync(fn,options){void 0===options&&(options={});var defer=options.defer,pipe=options.pipe,initialValue=options.initialValue,onSuccess=options.onSuccess,onFailure=options.onFailure,_a=react_1.useReducer(reducer,__assign(__assign({},initialArg),{data:initialValue})),state=_a[0],dispatch=_a[1],deferRef=react_1.useRef(!!defer),subscription=react_1.useRef(new rxjs_1.Subscription),run=react_1.useCallback((function(){dispatch({type:"FETCH_INIT"});var source$=rxjs_1.from(fn());pipe&&(source$=source$.pipe(pipe));var newSubscription=source$.subscribe((function(payload){dispatch({type:"FETCH_SUCCESS",payload:payload}),onSuccess&&onSuccess(payload)}),(function(payload){dispatch({type:"FETCH_FAILURE",payload:payload}),onFailure&&onFailure(payload)}));subscription.current.unsubscribe(),subscription.current=newSubscription}),[fn,pipe,onSuccess,onFailure]),cancel=react_1.useCallback((function(){subscription.current.unsubscribe(),dispatch({type:"CANCEL"})}),[dispatch,subscription]);return react_1.useEffect((function(){!1===deferRef.current&&run(),deferRef.current=!1}),[dispatch,run]),__assign(__assign({},state),{run:run,cancel:cancel})}},139:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__rest=this&&this.__rest||function(s,e){var t={};for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0&&(t[p]=s[p]);if(null!=s&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(p=Object.getOwnPropertySymbols(s);i<p.length;i++)e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i])&&(t[p[i]]=s[p[i]])}return t},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(__webpack_require__(1)),components_1=__webpack_require__(91);exports.Preview=function(_a){var _b=_a.language,language=void 0===_b?"jsx":_b,code=_a.code,children=_a.children,withSource=_a.withSource,props=__rest(_a,["language","code","children","withSource"]);return console.log(code.split("\n")),react_1.default.createElement(components_1.Preview,__assign({withSource:__assign(__assign({},withSource),{code:code,language:language})},props),children)},exports.delay=function(ms){return new Promise((function(_){return setTimeout(_,ms)}))}},160:function(module,exports,__webpack_require__){"use strict";var __importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(__webpack_require__(1)),delay=function(ms){return new Promise((function(_){return setTimeout(_,ms)}))};exports.request=function(){return delay(2e3).then((function(){return"done!"}))},exports.request2=function(){return delay(2e3).then((function(){return Math.random()}))},exports.request3=function(result){return delay(2e3).then((function(){return result}))},exports.Result=function Result(_a){var loading=_a.loading,error=_a.error,data=_a.data,content=loading?"Loading...":error?"Error !":data?"object"==typeof data?JSON.stringify(data,null,2):data:" ";return react_1.default.createElement("pre",null,content)}},414:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(__webpack_require__(1)),useRxAsync_1=__webpack_require__(113),utils_1=__webpack_require__(160);exports.Basic=function(){var state=useRxAsync_1.useRxAsync(utils_1.request);return react_1.default.createElement(utils_1.Result,__assign({},state))}},415:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(__webpack_require__(1)),useRxAsync_1=__webpack_require__(113),utils_1=__webpack_require__(160);exports.Cancellation=function(){var state=useRxAsync_1.useRxAsync(utils_1.request2,{defer:!0});return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("button",{onClick:state.run},"Get Result"),react_1.default.createElement("button",{onClick:state.cancel},"Cancel"),react_1.default.createElement(utils_1.Result,__assign({},state)))}},416:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importDefault=this&&this.__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importDefault(__webpack_require__(1)),useRxAsync_1=__webpack_require__(113),utils_1=__webpack_require__(160);exports.Defer=function(){var state=useRxAsync_1.useRxAsync(utils_1.request,{defer:!0});return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("button",{onClick:state.run},"Get Result"),react_1.default.createElement(utils_1.Result,__assign({},state)))}},417:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(__webpack_require__(1)),useRxAsync_1=__webpack_require__(113),utils_1=__webpack_require__(160);exports.DynamicParameters=function(){var _a=react_1.useState(0),result=_a[0],setResult=_a[1],callback=react_1.useCallback((function(){return utils_1.request3(result)}),[result]),state=useRxAsync_1.useRxAsync(callback,{defer:!0});return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("h5",null,"Click on the button to get a result"),react_1.default.createElement("button",{onClick:function(){return setResult(100)}},"100"),react_1.default.createElement("button",{onClick:function(){return setResult(200)}},"200"),react_1.default.createElement("button",{onClick:function(){return setResult(300)}},"300"),react_1.default.createElement(utils_1.Result,__assign({},state)))}},418:function(module,exports,__webpack_require__){"use strict";var __assign=this&&this.__assign||function(){return(__assign=Object.assign||function(t){for(var s,i=1,n=arguments.length;i<n;i++)for(var p in s=arguments[i])Object.prototype.hasOwnProperty.call(s,p)&&(t[p]=s[p]);return t}).apply(this,arguments)},__importStar=this&&this.__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(null!=mod)for(var k in mod)Object.hasOwnProperty.call(mod,k)&&(result[k]=mod[k]);return result.default=mod,result};Object.defineProperty(exports,"__esModule",{value:!0});var react_1=__importStar(__webpack_require__(1)),operators_1=__webpack_require__(842),useRxAsync_1=__webpack_require__(113),utils_1=__webpack_require__(160);exports.Pipe=function(){var _a=react_1.useState(0),result=_a[0],setResult=_a[1],callback=react_1.useCallback((function(){return utils_1.request3(result)}),[result]),state=useRxAsync_1.useRxAsync(callback,{defer:!0,pipe:function(ob){return ob.pipe(operators_1.map((function(v){return 2*v})))}});return react_1.default.createElement(react_1.default.Fragment,null,react_1.default.createElement("button",{onClick:function(){return setResult(100)}},"100"),react_1.default.createElement("button",{onClick:function(){return setResult(200)}},"200"),react_1.default.createElement("button",{onClick:function(){return setResult(300)}},"300"),react_1.default.createElement(utils_1.Result,__assign({},state)))}},419:function(module,exports,__webpack_require__){__webpack_require__(420),__webpack_require__(529),module.exports=__webpack_require__(530)},441:function(module,exports){},530:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__),function(module){var _storybook_react__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(406);Object(_storybook_react__WEBPACK_IMPORTED_MODULE_0__.configure)(__webpack_require__(721),module)}.call(this,__webpack_require__(531)(module))},721:function(module,exports,__webpack_require__){var map={"./__stories__/useRxAsync/useRxAsync.stories.mdx":844};function webpackContext(req){var id=webpackContextResolve(req);return __webpack_require__(id)}function webpackContextResolve(req){if(!__webpack_require__.o(map,req)){var e=new Error("Cannot find module '"+req+"'");throw e.code="MODULE_NOT_FOUND",e}return map[req]}webpackContext.keys=function webpackContextKeys(){return Object.keys(map)},webpackContext.resolve=webpackContextResolve,module.exports=webpackContext,webpackContext.id=721},844:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.r(__webpack_exports__);__webpack_require__(1);var index_es=__webpack_require__(14),blocks=__webpack_require__(163),useRxAsync=__webpack_require__(113),utils=__webpack_require__(139),Basic=__webpack_require__(414),Cancellation=__webpack_require__(415),Defer=__webpack_require__(416),DynamicParameters=__webpack_require__(417),Pipe=__webpack_require__(418),useRxAsync_utils="import React from 'react';\nimport { useRxAsync } from '../../useRxAsync';\n\ntype Props = ReturnType<typeof useRxAsync>;\n\nconst delay = (ms: number) => new Promise(_ => setTimeout(_, ms));\n\nexport const request = () => delay(2000).then(() => 'done!');\nexport const request2 = () => delay(2000).then(() => Math.random());\nexport const request3 = (result: number) => delay(2000).then(() => result);\n\nexport function Result({ loading, error, data }: Props) {\n  const content = (() => {\n    if (loading) {\n      return 'Loading...';\n    }\n\n    if (!!error) {\n      return 'Error !';\n    }\n\n    if (data) {\n      if (typeof data === 'object') {\n        return JSON.stringify(data, null, 2);\n      }\n\n      return data;\n    }\n\n    return ' ';\n  })();\n\n  return <pre>{content}</pre>;\n}\n",useRxAsync_Basic="import React from 'react';\nimport { useRxAsync } from '../../useRxAsync';\nimport { Result, request } from './utils';\n\nexport const Basic = () => {\n  const state = useRxAsync(request);\n  return <Result {...state} />;\n};\n",useRxAsync_Cancellation="import React from 'react';\nimport { useRxAsync } from '../../useRxAsync';\nimport { Result, request2 } from './utils';\n\nexport const Cancellation = () => {\n  const state = useRxAsync(request2, { defer: true });\n  return (\n    <>\n      <button onClick={state.run}>Get Result</button>\n      <button onClick={state.cancel}>Cancel</button>\n      <Result {...state} />\n    </>\n  );\n};\n",useRxAsync_Defer="import React from 'react';\nimport { useRxAsync } from '../../useRxAsync';\nimport { Result, request } from './utils';\n\nexport const Defer = () => {\n  const state = useRxAsync(request, { defer: true });\n  return (\n    <>\n      <button onClick={state.run}>Get Result</button>\n      <Result {...state} />\n    </>\n  );\n};\n",useRxAsync_DynamicParameters="import React, { useState, useCallback } from 'react';\nimport { useRxAsync } from '../../useRxAsync';\nimport { Result, request3 } from './utils';\n\nexport const DynamicParameters = () => {\n  const [result, setResult] = useState(0);\n  const callback = useCallback(() => request3(result), [result]);\n  const state = useRxAsync(callback, { defer: true });\n  return (\n    <>\n      <h5>Click on the button to get a result</h5>\n      <button onClick={() => setResult(100)}>100</button>\n      <button onClick={() => setResult(200)}>200</button>\n      <button onClick={() => setResult(300)}>300</button>\n      <Result {...state} />\n    </>\n  );\n};\n",useRxAsync_Pipe="import React, { useState, useCallback } from 'react';\nimport { Observable } from 'rxjs';\nimport { map } from 'rxjs/operators';\nimport { useRxAsync } from '../../useRxAsync';\nimport { Result, request3 } from './utils';\n\nexport const Pipe = () => {\n  const double = (ob: Observable<number>) => ob.pipe(map(v => v * 2));\n\n  const [result, setResult] = useState(0);\n  const callback = useCallback(() => request3(result), [result]);\n  const state = useRxAsync(callback, { defer: true, pipe: double });\n\n  return (\n    <>\n      <button onClick={() => setResult(100)}>100</button>\n      <button onClick={() => setResult(200)}>200</button>\n      <button onClick={() => setResult(300)}>300</button>\n      <Result {...state} />\n    </>\n  );\n};\n";function _extends(){return(_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target}).apply(this,arguments)}__webpack_require__.d(__webpack_exports__,"__page",(function(){return __page}));const layoutProps={},MDXLayout="wrapper";function MDXContent({components:components,...props}){return Object(index_es.mdx)(MDXLayout,_extends({},layoutProps,props,{components:components,mdxType:"MDXLayout"}),Object(index_es.mdx)(blocks.Meta,{title:"useRxAsync",component:useRxAsync.useRxAsync,parameters:{docs:{page:null}},mdxType:"Meta"}),Object(index_es.mdx)("h1",null,"useRxAsync"),Object(index_es.mdx)("pre",null,Object(index_es.mdx)("code",_extends({parentName:"pre"},{className:"language-js"}),"const state = useRxAsync(input, options?);\n")),Object(index_es.mdx)("h2",null,"Typings"),Object(index_es.mdx)("pre",null,Object(index_es.mdx)("code",_extends({parentName:"pre"},{className:"language-js"}),"interface State<T> {\n  loading: boolean;\n  error?: any;\n  data?: T;\n  run: () => void;\n  cancel: () => void;\n}\n\ninterface RxAsyncOptions<I, O = I> {\n  initialValue?: O;\n  defer?: boolean;\n  pipe?(ob: Observable<I>): Observable<O>;\n  onSuccess?(value: O): void;\n  onFailure?(error: any): void;\n}\n\ndeclare function useRxAsync<T, O = T>(\n  input: ObservableInput<T>,\n  options?: RxAsyncOptions<T, O>\n): State<O>;\n")),Object(index_es.mdx)("h2",null,"Demo"),Object(index_es.mdx)("blockquote",null,Object(index_es.mdx)("p",{parentName:"blockquote"},"Shared code used in below demo")),Object(index_es.mdx)(blocks.Source,_extends({code:useRxAsync_utils,language:"jsx"},{mdxType:"Source"})),Object(index_es.mdx)("h3",null,"Basic"),Object(index_es.mdx)(utils.Preview,{name:"Basic",code:useRxAsync_Basic,mdxType:"Preview"},Object(index_es.mdx)(Basic.Basic,{mdxType:"Basic"})),Object(index_es.mdx)("h3",null,"Cancellation"),Object(index_es.mdx)(utils.Preview,{name:"Cancellation",code:useRxAsync_Cancellation,mdxType:"Preview"},Object(index_es.mdx)(Cancellation.Cancellation,{mdxType:"Cancellation"})),Object(index_es.mdx)("h3",null,"Defer"),Object(index_es.mdx)(utils.Preview,{name:"Cancellation",code:useRxAsync_Defer,mdxType:"Preview"},Object(index_es.mdx)(Defer.Defer,{mdxType:"Defer"})),Object(index_es.mdx)("h3",null,"DynamicParameters"),Object(index_es.mdx)(utils.Preview,{name:"Cancellation",code:useRxAsync_DynamicParameters,mdxType:"Preview"},Object(index_es.mdx)(DynamicParameters.DynamicParameters,{mdxType:"DynamicParameters"})),Object(index_es.mdx)("h3",null,"Pipe"),Object(index_es.mdx)("blockquote",null,Object(index_es.mdx)("p",{parentName:"blockquote"},"The result will be double")),Object(index_es.mdx)(utils.Preview,{name:"Cancellation",code:useRxAsync_Pipe,mdxType:"Preview"},Object(index_es.mdx)(Pipe.Pipe,{mdxType:"Pipe"})))}MDXContent.isMDXComponent=!0;const __page=()=>{throw new Error("Docs-only story")};__page.story={parameters:{docsOnly:!0}};const componentMeta={title:"useRxAsync",parameters:{docs:{page:null}},includeStories:["__page"]},mdxStoryNameToId={};componentMeta.parameters=componentMeta.parameters||{},componentMeta.parameters.docs={container:({context:context,children:children})=>Object(index_es.mdx)(blocks.DocsContainer,{context:{...context,mdxStoryNameToId:mdxStoryNameToId}},children),page:MDXContent};__webpack_exports__.default=componentMeta}},[[419,1,2]]]);
//# sourceMappingURL=main.867cb652ef5b54d503a8.bundle.js.map