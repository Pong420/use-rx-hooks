import { Meta, Story, Source } from '@storybook/addon-docs/blocks';
import { useRxAsync } from '../../useRxAsync';
import { Preview } from '../utils';
import { Basic } from './Basic.tsx';
import { Cancellation } from './Cancellation.tsx';
import { Defer } from './Defer.tsx';
import { DynamicParameters } from './DynamicParameters.tsx';
import { Pipe } from './Pipe.tsx';

import sharedCode from '!!raw-loader!./utils.tsx';
import basicCode from '!!raw-loader!./Basic.tsx';
import cancellationCode from '!!raw-loader!./Cancellation.tsx';
import deferCode from '!!raw-loader!./Defer.tsx';
import dynamicParametersCode from '!!raw-loader!./DynamicParameters.tsx';
import pipeCode from '!!raw-loader!./Pipe.tsx';

<Meta title="useRxAsync" />

# useRxAsync

```js
const state = useRxAsync(fn, options?);
```

## Typings

```js
export interface RxAsyncState<T> {
  loading: boolean;
  error?: any;
  data?: T;
  run: () => void;
  cancel: () => void;
  reset: () => void;
}

export interface RxAsyncOptions<I, O = I> {
  initialValue?: O;
  defer?: boolean;
  pipe?(ob: Observable<I>): Observable<O>;
  onSuccess?(value: O): void;
  onFailure?(error: any): void;
}

type AsyncFn<T> = () => ObservableInput<T>;

export function useRxAsync<T, O = T>(
  fn: AsyncFn<O>,
  options?: RxAsyncOptions<T, O>
): RxAsyncState<O>;
```

### Basic

<Preview name="Basic" code={basicCode}>
  <Basic />
</Preview>

### Cancellation

<Preview name="Cancellation" code={cancellationCode}>
  <Cancellation />
</Preview>

### Defer

<Preview name="Cancellation" code={deferCode}>
  <Defer />
</Preview>

### Dynamic Parameters

<Preview name="Cancellation" code={dynamicParametersCode}>
  <DynamicParameters />
</Preview>

### Double Result (Pipe)

<Preview name="Cancellation" code={pipeCode}>
  <Pipe />
</Preview>
